================================================================================
    Tá»”NG QUAN LOGIC Xá»¬ LÃ MULTIPLE END_QRS
================================================================================

ğŸ“‹ YÃŠU Cáº¦U:
-----------
Vá»›i cáº¥u hÃ¬nh:
  {
    "start_qr": 62,
    "end_qrs": ["13", "32"]  // 2 hoáº·c 3 end_qrs
  }

â†’ CHá»ˆ PUBLISH 1 Cáº¶P DUY NHáº¤T cho má»—i start_qr, khÃ´ng spam nhiá»u messages

================================================================================

ğŸ¯ LOGIC:
---------

BÆ¯á»šC 1: Kiá»ƒm tra start_qr
  âœ… start_qr pháº£i = shelf (stable â‰¥5s)

BÆ¯á»šC 2: Thu tháº­p end_qrs Ä‘ang empty
  - Duyá»‡t táº¥t cáº£ end_qrs trong config
  - LÆ°u danh sÃ¡ch cÃ¡c end_qrs = empty (stable â‰¥5s)

BÆ¯á»šC 3: Quyáº¿t Ä‘á»‹nh publish
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Sá»‘ end_qrs empty â”‚ HÃ nh Ä‘á»™ng                                     â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ 0                â”‚ âŒ KHÃ”NG publish                              â”‚
  â”‚ 1                â”‚ âœ… Publish cáº·p Ä‘Ã³                             â”‚
  â”‚ 2/3 (má»™t sá»‘)     â”‚ âœ… Publish end_qr Äáº¦U TIÃŠN trong list empty  â”‚
  â”‚ 2/2 hoáº·c 3/3     â”‚ âœ… Publish end_qr Äáº¦U TIÃŠN + flag ALL_EMPTY  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================

ğŸ“¦ PAYLOAD:
-----------

CASE 1: Chá»‰ 1 end_qr empty
  {
    "pair_id": "62 -> 32",
    "start_slot": "62",
    "end_slot": "32",
    "stable_since": "2024-..."
  }

CASE 2: Táº¤T Cáº¢ end_qrs empty
  {
    "pair_id": "62 -> 13",
    "start_slot": "62",
    "end_slot": "13",                          â† Chá»n Ä‘áº§u tiÃªn
    "all_empty_end_slots": ["13", "32"],       â† ThÃ´ng tin táº¥t cáº£
    "is_all_empty": true,                      â† Flag Ä‘áº·c biá»‡t
    "stable_since": "2024-..."
  }

================================================================================

ğŸ”¥ VÃ Dá»¤ THá»°C Táº¾:
-----------------

Config: start_qr=62, end_qrs=[13, 32, 41]

T=0s:   62=empty, 13=shelf, 32=shelf, 41=shelf
        âœ ChÆ°a publish (start chÆ°a cÃ³ hÃ ng)

T=8s:   62=shelf (stable), 13=shelf, 32=shelf, 41=shelf
        âœ ChÆ°a publish (khÃ´ng cÃ³ end nÃ o empty)

T=20s:  62=shelf, 13=shelf, 32=empty (stable), 41=shelf
        âœ âœ… PUBLISH "62 -> 32" (chá»‰ 32 empty)

T=35s:  62=shelf, 13=empty (stable), 32=empty (stable), 41=shelf
        âœ âœ… PUBLISH "62 -> 13" (chá»n 13 vÃ¬ Ä‘á»©ng Ä‘áº§u)

T=50s:  62=shelf, 13=empty, 32=empty, 41=empty (táº¥t cáº£ stable)
        âœ âœ… PUBLISH "62 -> 13" vá»›i:
            - is_all_empty = true
            - all_empty_end_slots = [13, 32, 41]

================================================================================

âš™ï¸ THAM Sá»:
-----------
- stable_seconds: 5.0       (thá»i gian stable tá»‘i thiá»ƒu)
- cooldown_seconds: 10.0    (thá»i gian cooldown giá»¯a 2 láº§n publish)

================================================================================

ğŸ§ª TEST:
--------
Cháº¡y test Ä‘á»ƒ kiá»ƒm tra:

1. Xem history:
   python test/test_multi_end_qrs.py view

2. Monitor real-time:
   python test/test_multi_end_qrs.py monitor

3. PhÃ¢n tÃ­ch patterns:
   python test/test_multi_end_qrs.py analyze

================================================================================

âœ… Lá»¢I ÃCH:
-----------
âœ“ TrÃ¡nh spam: Chá»‰ 1 message thay vÃ¬ 2-3 messages
âœ“ ThÃ´ng tin Ä‘áº§y Ä‘á»§: Payload chá»©a info vá» táº¥t cáº£ Ä‘iá»ƒm Ä‘áº¿n trá»‘ng
âœ“ Æ¯u tiÃªn thÃ´ng minh: Chá»n theo thá»© tá»± trong config

================================================================================

